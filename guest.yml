---
- name: setup ubuntu guest
  hosts: guests
  vars:
    golang: true
    terraform: true
    ansible: true
    perl: true
    kvm: true
    rabbit: true
    verbose: true
  gather_facts: false
  tasks:
    - name: add user to the src group
      user:
        name: "{{ ansible_user }}"
        group: adm
        groups: src,sudo
        append: yes
      become: true

    - name: create /usr/local/git directory
      file: path=/usr/local/git state=directory group=src mode=0775
      become: true

    - name: install general pre-requisite packages
      apt: name={{ item }} state=present update_cache=true
      items:
        - binutils
      become: true

    - name: build & install the latest golang
      import_tasks: tasks/golang.yml
      when: golang|bool

    - name: build & install the latest terraform
      import_tasks: tasks/terraform.yml
      when: terraform|bool

    - name: install the latest ansible
      import_tasks: tasks/ansible.yml
      when: ansible|bool

    - name: install the latest perl
      import_tasks: tasks/perl.yml
      when: perl|bool

    - name: setup KVM environment
      import_tasks: tasks/kvm.yml
      when: kvm|bool

    - name: setup RabbitMQ environment
      import_tasks: tasks/rabbit.yml
      vars:
        username: rabbit
        password: RabbitMQ
        vhost: hole
        configure_priv: ".*"
        read_priv: ".*"
        write_priv: ".*"
      when: rabbit|bool
