---
- name: arch-on-air hack playbook
  hosts: host
  vars:
    latest: false
    travis_ci: false
    gitsite: "git@github.com:"
    gitpath: "{{ lookup('env', 'HOME') }}/git/"
    gobootstrap: /usr/lib/go
  gather_facts: false
  tasks:
    - name: add user to the developer groups
      user:
        name: "{{ lookup('env', 'USER') }}"
        append: true
        groups: git,docker,libvirt
      become: true
      when: not travis_ci|bool

    - name: create git root directory
      file: path={{ gitpath }} state=directory mode=0700

    - name: configure the docker environment
      import_tasks: tasks/docker.yml
      when: not travis_ci|bool

    - name: install the latest Open vSwitch
      import_tasks: tasks/openvswitch.yml

    - name: install the latest golang
      import_tasks: tasks/golang.yml

    - name: install the latest protobuf
      import_tasks: tasks/protobuf.yml
      when: latest|bool and not travis_ci|bool

    - name: install the latest etcd
      import_tasks: tasks/etcd.yml
      when: latest|bool

    - name: install the latest kubernetes
      import_tasks: tasks/kubernetes.yml
      when: latest|bool and not travis_ci|bool

    - name: install the latest terraform
      import_tasks: tasks/terraform.yml
      when: latest|bool

    - name: install the latest ansible
      import_tasks: tasks/ansible.yml
      when: latest|bool

    - name: install the latest perl
      import_tasks: tasks/perl.yml
      when: latest|bool
